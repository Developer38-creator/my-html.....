<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Advanced Calculator App
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: 'Roboto Mono', monospace;
    }
    /* Custom scrollbar for results */
    #history {
      scrollbar-width: thin;
      scrollbar-color: #a0aec0 #edf2f7;
    }
    #history::-webkit-scrollbar {
      width: 6px;
    }
    #history::-webkit-scrollbar-track {
      background: #edf2f7;
      border-radius: 3px;
    }
    #history::-webkit-scrollbar-thumb {
      background-color: #a0aec0;
      border-radius: 3px;
    }
  </style>
 </head>
 <body class="bg-gradient-to-br from-indigo-600 via-purple-700 to-pink-600 min-h-screen flex items-center justify-center p-4">
  <main aria-label="Advanced calculator application" class="bg-white bg-opacity-90 backdrop-blur-md rounded-3xl shadow-2xl max-w-md w-full flex flex-col" role="main">
   <header class="p-6 border-b border-gray-300 flex flex-col items-center">
    <img alt="Icon of a calculator with digital display and buttons" class="mb-3 rounded-full shadow-md" height="80" loading="lazy" src="https://storage.googleapis.com/a1aa/image/5b24fe84-155e-4563-177e-55c8835cf082.jpg" width="80"/>
    <h1 class="text-3xl font-extrabold text-indigo-900 select-none">
     Advanced Calculator
    </h1>
    <p class="text-indigo-700 mt-1 text-sm font-medium select-none">
     Scientific &amp; Financial Calculator with History &amp; Memory
    </p>
   </header>
   <section class="p-6 flex flex-col space-y-4">
    <div aria-atomic="true" aria-live="polite" class="bg-gray-100 rounded-xl p-4 min-h-[4.5rem] text-right text-3xl font-semibold text-gray-900 break-words select-text" id="display">
     0
    </div>
    <div aria-label="Current expression" class="text-right text-gray-500 text-sm min-h-[1.5rem] font-mono select-text" id="subDisplay">
    </div>
    <div class="flex justify-between items-center space-x-2">
     <button aria-label="Clear all" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-bold rounded-lg py-2 shadow-md focus:outline-none focus:ring-4 focus:ring-red-300 transition" id="clear">
      AC
     </button>
     <button aria-label="Backspace" class="flex-1 bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-bold rounded-lg py-2 shadow-md focus:outline-none focus:ring-4 focus:ring-yellow-300 transition" id="backspace">
      <i class="fas fa-backspace">
      </i>
     </button>
     <button aria-label="Memory recall" class="flex-1 bg-blue-400 hover:bg-blue-500 text-white font-bold rounded-lg py-2 shadow-md focus:outline-none focus:ring-4 focus:ring-blue-300 transition" id="memoryRecall">
      MR
     </button>
     <button aria-label="Memory clear" class="flex-1 bg-blue-400 hover:bg-blue-500 text-white font-bold rounded-lg py-2 shadow-md focus:outline-none focus:ring-4 focus:ring-blue-300 transition" id="memoryClear">
      MC
     </button>
     <button aria-label="Memory add" class="flex-1 bg-blue-400 hover:bg-blue-500 text-white font-bold rounded-lg py-2 shadow-md focus:outline-none focus:ring-4 focus:ring-blue-300 transition" id="memoryAdd">
      M+
     </button>
    </div>
    <div aria-label="Calculator buttons" class="grid grid-cols-5 gap-3 text-gray-900 font-semibold text-lg select-none" role="group">
     <button aria-label="Sine function" class="py-3 rounded-lg bg-gradient-to-tr from-indigo-300 to-indigo-400 hover:from-indigo-400 hover:to-indigo-500 shadow-md focus:outline-none focus:ring-4 focus:ring-indigo-300" data-action="function" data-value="sin(" type="button">
      sin
     </button>
     <button aria-label="Cosine function" class="py-3 rounded-lg bg-gradient-to-tr from-indigo-300 to-indigo-400 hover:from-indigo-400 hover:to-indigo-500 shadow-md focus:outline-none focus:ring-4 focus:ring-indigo-300" data-action="function" data-value="cos(" type="button">
      cos
     </button>
     <button aria-label="Tangent function" class="py-3 rounded-lg bg-gradient-to-tr from-indigo-300 to-indigo-400 hover:from-indigo-400 hover:to-indigo-500 shadow-md focus:outline-none focus:ring-4 focus:ring-indigo-300" data-action="function" data-value="tan(" type="button">
      tan
     </button>
     <button aria-label="Log base 10 function" class="py-3 rounded-lg bg-gradient-to-tr from-indigo-300 to-indigo-400 hover:from-indigo-400 hover:to-indigo-500 shadow-md focus:outline-none focus:ring-4 focus:ring-indigo-300" data-action="function" data-value="log10(" type="button">
      log
     </button>
     <button aria-label="Natural logarithm function" class="py-3 rounded-lg bg-gradient-to-tr from-indigo-300 to-indigo-400 hover:from-indigo-400 hover:to-indigo-500 shadow-md focus:outline-none focus:ring-4 focus:ring-indigo-300" data-action="function" data-value="ln(" type="button">
      ln
     </button>
     <button aria-label="Open parenthesis" class="py-3 rounded-lg bg-gray-200 hover:bg-gray-300 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="parenthesis" data-value="(" type="button">
      (
     </button>
     <button aria-label="Close parenthesis" class="py-3 rounded-lg bg-gray-200 hover:bg-gray-300 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="parenthesis" data-value=")" type="button">
      )
     </button>
     <button aria-label="Exponentiation" class="py-3 rounded-lg bg-yellow-300 hover:bg-yellow-400 shadow-md focus:outline-none focus:ring-4 focus:ring-yellow-300" data-action="operator" data-value="^" type="button">
      ^
     </button>
     <button aria-label="Divide" class="py-3 rounded-lg bg-yellow-300 hover:bg-yellow-400 shadow-md focus:outline-none focus:ring-4 focus:ring-yellow-300" data-action="operator" data-value="/" type="button">
      ÷
     </button>
     <button aria-label="Multiply" class="py-3 rounded-lg bg-yellow-300 hover:bg-yellow-400 shadow-md focus:outline-none focus:ring-4 focus:ring-yellow-300" data-action="operator" data-value="*" type="button">
      ×
     </button>
     <button aria-label="Number seven" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="7" type="button">
      7
     </button>
     <button aria-label="Number eight" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="8" type="button">
      8
     </button>
     <button aria-label="Number nine" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="9" type="button">
      9
     </button>
     <button aria-label="Subtract" class="py-3 rounded-lg bg-yellow-300 hover:bg-yellow-400 shadow-md focus:outline-none focus:ring-4 focus:ring-yellow-300" data-action="operator" data-value="-" type="button">
      −
     </button>
     <button aria-label="Add" class="py-3 rounded-lg bg-yellow-300 hover:bg-yellow-400 shadow-md focus:outline-none focus:ring-4 focus:ring-yellow-300" data-action="operator" data-value="+" type="button">
      +
     </button>
     <button aria-label="Number four" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="4" type="button">
      4
     </button>
     <button aria-label="Number five" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="5" type="button">
      5
     </button>
     <button aria-label="Number six" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="6" type="button">
      6
     </button>
     <button aria-label="Square root function" class="py-3 rounded-lg bg-indigo-300 hover:bg-indigo-400 shadow-md focus:outline-none focus:ring-4 focus:ring-indigo-300" data-action="function" data-value="sqrt(" type="button">
      √
     </button>
     <button aria-label="Calculate result" class="py-3 rounded-lg bg-green-500 hover:bg-green-600 text-white shadow-md focus:outline-none focus:ring-4 focus:ring-green-300" id="equals" type="button">
      =
     </button>
     <button aria-label="Number one" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="1" type="button">
      1
     </button>
     <button aria-label="Number two" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="2" type="button">
      2
     </button>
     <button aria-label="Number three" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="3" type="button">
      3
     </button>
     <button aria-label="Absolute value function" class="py-3 rounded-lg bg-indigo-300 hover:bg-indigo-400 shadow-md focus:outline-none focus:ring-4 focus:ring-indigo-300" data-action="function" data-value="abs(" type="button">
      |x|
     </button>
     <button aria-label="Clear entry" class="py-3 rounded-lg bg-red-400 hover:bg-red-500 text-white shadow-md focus:outline-none focus:ring-4 focus:ring-red-300" id="clearEntry" type="button">
      CE
     </button>
     <button aria-label="Number zero" class="col-span-2 py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="number" data-value="0" type="button">
      0
     </button>
     <button aria-label="Decimal point" class="py-3 rounded-lg bg-gray-100 hover:bg-gray-200 shadow-md focus:outline-none focus:ring-4 focus:ring-gray-300" data-action="decimal" data-value="." type="button">
      .
     </button>
     <button aria-label="Pi constant" class="py-3 rounded-lg bg-indigo-300 hover:bg-indigo-400 shadow-md focus:outline-none focus:ring-4 focus:ring-indigo-300" data-action="function" data-value="pi" type="button">
      π
     </button>
     <button aria-label="Euler's number constant" class="py-3 rounded-lg bg-indigo-300 hover:bg-indigo-400 shadow-md focus:outline-none focus:ring-4 focus:ring-indigo-300" data-action="function" data-value="e" type="button">
      e
     </button>
    </div>
   </section>
   <section aria-label="Calculation history" class="p-6 border-t border-gray-300 max-h-48 overflow-y-auto bg-gray-50 rounded-b-3xl" id="historySection">
    <h2 class="text-indigo-900 font-bold mb-2 text-lg select-none">
     History
    </h2>
    <ul class="space-y-1 text-gray-700 font-mono text-sm" id="history">
    </ul>
   </section>
  </main>
  <script>
   (() => {
      const display = document.getElementById('display');
      const subDisplay = document.getElementById('subDisplay');
      const historyList = document.getElementById('history');
      const buttons = document.querySelectorAll('button[data-action]');
      const clearBtn = document.getElementById('clear');
      const clearEntryBtn = document.getElementById('clearEntry');
      const backspaceBtn = document.getElementById('backspace');
      const equalsBtn = document.getElementById('equals');
      const memoryRecallBtn = document.getElementById('memoryRecall');
      const memoryClearBtn = document.getElementById('memoryClear');
      const memoryAddBtn = document.getElementById('memoryAdd');

      let expression = '';
      let memory = 0;
      let lastResult = null;

      // Helper: sanitize expression for display
      function sanitizeForDisplay(expr) {
        return expr
          .replace(/\*/g, '×')
          .replace(/\//g, '÷')
          .replace(/\^/g, '^')
          .replace(/Math\.PI/g, 'π')
          .replace(/Math\.E/g, 'e');
      }

      // Update displays
      function updateDisplay() {
        if (expression === '') {
          display.textContent = '0';
          subDisplay.textContent = '';
        } else {
          subDisplay.textContent = sanitizeForDisplay(expression);
          display.textContent = expression;
        }
      }

      // Append value to expression
      function appendToExpression(value) {
        if (expression === '0' && /[0-9]/.test(value)) {
          expression = value;
        } else {
          expression += value;
        }
        updateDisplay();
      }

      // Remove last character
      function backspace() {
        if (expression.length > 0) {
          expression = expression.slice(0, -1);
          updateDisplay();
        }
      }

      // Clear all
      function clearAll() {
        expression = '';
        updateDisplay();
      }

      // Clear entry (last number or function)
      function clearEntry() {
        if (expression.length === 0) return;
        // Remove last number or function
        // Regex to remove last number, decimal, or function call
        const regex = /(\d+\.?\d*|\.\d+|[a-z]+\(|\)|\^|[+\-*/])$/i;
        expression = expression.replace(regex, '');
        updateDisplay();
      }

      // Memory functions
      function memoryRecall() {
        if (memory !== null) {
          appendToExpression(memory.toString());
        }
      }
      function memoryClear() {
        memory = 0;
      }
      function memoryAdd() {
        if (lastResult !== null) {
          memory += lastResult;
        }
      }

      // Evaluate expression safely
      function evaluateExpression(expr) {
        // Replace constants
        let safeExpr = expr
          .replace(/pi/g, 'Math.PI')
          .replace(/π/g, 'Math.PI')
          .replace(/e/g, 'Math.E')
          .replace(/÷/g, '/')
          .replace(/×/g, '*')
          .replace(/\^/g, '**');

        // Replace functions with Math equivalents
        // Supported functions: sin, cos, tan, log10, ln, sqrt, abs
        safeExpr = safeExpr
          .replace(/sin\(/g, 'Math.sin(')
          .replace(/cos\(/g, 'Math.cos(')
          .replace(/tan\(/g, 'Math.tan(')
          .replace(/log10\(/g, 'Math.log10(')
          .replace(/ln\(/g, 'Math.log(')
          .replace(/sqrt\(/g, 'Math.sqrt(')
          .replace(/abs\(/g, 'Math.abs(');

        // Prevent unsafe characters
        if (/[^-()\d/*+.eE MathsincoagtlqrabsPIlnt0]/.test(safeExpr)) {
          throw new Error('Invalid characters in expression');
        }

        // Evaluate with Function constructor
        // eslint-disable-next-line no-new-func
        const func = new Function(`return ${safeExpr}`);
        return func();
      }

      // Add to history
      function addHistory(expr, result) {
        const li = document.createElement('li');
        li.className =
          'flex justify-between bg-white rounded-md px-3 py-1 shadow-sm hover:bg-indigo-50 cursor-pointer select-text';
        li.tabIndex = 0;
        li.setAttribute('role', 'button');
        li.setAttribute('aria-label', `Expression: ${expr}, Result: ${result}. Click to reuse result.`);
        li.textContent = `${sanitizeForDisplay(expr)} = ${result}`;
        li.addEventListener('click', () => {
          expression = result.toString();
          updateDisplay();
          display.focus();
        });
        historyList.prepend(li);
      }

      // Button click handler
      buttons.forEach((btn) => {
        btn.addEventListener('click', () => {
          const action = btn.getAttribute('data-action');
          const value = btn.getAttribute('data-value');

          switch (action) {
            case 'number':
            case 'decimal':
            case 'operator':
            case 'parenthesis':
            case 'function':
              appendToExpression(value);
              break;
          }
        });
      });

      // Clear all
      clearBtn.addEventListener('click', () => {
        clearAll();
      });

      // Clear entry
      clearEntryBtn.addEventListener('click', () => {
        clearEntry();
      });

      // Backspace
      backspaceBtn.addEventListener('click', () => {
        backspace();
      });

      // Memory functions
      memoryRecallBtn.addEventListener('click', () => {
        memoryRecall();
      });
      memoryClearBtn.addEventListener('click', () => {
        memoryClear();
      });
      memoryAddBtn.addEventListener('click', () => {
        memoryAdd();
      });

      // Equals
      equalsBtn.addEventListener('click', () => {
        if (expression.trim() === '') return;
        try {
          const result = evaluateExpression(expression);
          if (typeof result === 'number' && !isNaN(result) && isFinite(result)) {
            addHistory(expression, result);
            lastResult = result;
            expression = result.toString();
            updateDisplay();
          } else {
            display.textContent = 'Error';
            subDisplay.textContent = '';
            expression = '';
          }
        } catch (e) {
          display.textContent = 'Error';
          subDisplay.textContent = '';
          expression = '';
        }
      });

      // Keyboard support
      window.addEventListener('keydown', (e) => {
        if (
          (e.key >= '0' && e.key <= '9') ||
          e.key === '.' ||
          e.key === '+' ||
          e.key === '-' ||
          e.key === '*' ||
          e.key === '/' ||
          e.key === '^' ||
          e.key === '(' ||
          e.key === ')'
        ) {
          e.preventDefault();
          appendToExpression(e.key);
        } else if (e.key === 'Enter' || e.key === '=') {
          e.preventDefault();
          equalsBtn.click();
        } else if (e.key === 'Backspace') {
          e.preventDefault();
          backspace();
        } else if (e.key.toLowerCase() === 'c' && e.ctrlKey) {
          e.preventDefault();
          clearAll();
        }
      });

      // Initialize display
      updateDisplay();
    })();
  </script>
 </body>
  </html>
  
